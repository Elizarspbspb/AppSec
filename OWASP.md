`OWASP Top 10` — стандартный, широко признанный список 10 наиболее критических рисков безопасности веб-приложений, который составляется некоммерческой организацией OWASP (Open Web Application Security Project) на основе анализа реальных уязвимостей, инцидентов и обратной связи от специалистов;

`Secure SDLC` — методология разработки ПО, которая встраивает практики безопасности на все этапы жизненного цикла (от идеи до поддержки), а не добавляет их в конце, чтобы выявлять и устранять уязвимости на самых ранних стациях, что снижает затраты и риски;

`OWASP ASVS` (Application Security Verification Standard) — это стандарт от OWASP (Open Web Application Security Project) с каталогом требований и критериев для проверки безопасности веб-приложений, который помогает разработчикам, архитекторам и тестировщикам создавать и оценивать защищенные приложения, охватывая всё: от аутентификации до защиты данных, с уровнями зрелости для разных рисков;

`OWASP SAMM` (Software Assurance Maturity Model) — фреймворк от OWASP для оценки и улучшения процессов безопасной разработки ПО, который помогает организациям построить эффективную стратегию кибербезопасности, измеряя зрелость практик безопасности на всех этапах жизненного цикла разработки (SDLC);

`CORS` (Cross-Origin Resource Sharing) — это механизм, который позволяет веб-приложениям безопасно запрашивать ресурсы с других доменов. Ключевые заголовки включают Access-Control-Allow-Origin, Access-Control-Allow-Methods, Access-Control-Allow-Headers, Access-Control-Allow-Credentials...

## Заголовки HTTP
`Заголовки HTTP` позволяют клиенту и серверу отправлять дополнительную информацию с HTTP запросом или ответом. `HTTP-заголовки` — это инструмент передачи `доверия` между компонентами.

Всего 4 группы HTTP-заголовков:
1. Основные (General)
2. Заголовки запроса (Request)
3. Заголовки ответа (Response)
4. Заголовки сущностей / представления (Entity / Representation)

### 1. Основные заголовки (General)
| Заголовок  | Риск | OWASP   |
| ---------- | ---- | ------- |
| Host | Host Header Injection, password reset hijack | A5, A10 |
| Forwarded  | IP spoofing, ACL bypass | A5 |
| Connection | Header smuggling | A5 |

### 2. Заголовки запроса (Request)
| Заголовок         | Что ломается              | OWASP   |
| ----------------- | ------------------------- | ------- |
| Authorization   | Broken auth, JWT bypass   | A2 / A7 |
| Cookie          | Session hijack, fixation  | A2      |
| Origin          | CORS bypass               | A5      |
| Referer         | CSRF bypass, token leak   | A8      |
| X-Forwarded-For | Rate-limit bypass         | A5      |
| User-Agent      | Stored XSS, log injection | A3      |

### 3. Заголовки ответа (Response Headers)
| Заголовок                     | Риск           | OWASP |
| ----------------------------- | -------------- | ----- |
| Set-Cookie                  | Session theft  | A2    |
| Access-Control-Allow-Origin | CORS misconfig | A5    |
| Location                    | Open redirect  | A10   |
| WWW-Authenticate            | Auth info leak | A2    |

### 4. Заголовки сущностей / представления
| Заголовок             | Атака                   | OWASP |
| --------------------- | ----------------------- | ----- |
| Content-Type        | File upload bypass, XSS | A3    |
| Content-Disposition | File overwrite          | A5    |
| Transfer-Encoding   | Request smuggling       | A5    |
| Content-Length      | Smuggling               | A5    |

### Сводная таблица: OWASP - заголовки
| OWASP категория         | Заголовки                         |
| ----------------------- | --------------------------------- |
| A2 Broken Auth      | Authorization, Cookie, Set-Cookie |
| A3 Injection        | User-Agent, Content-Type          |
| A5 Misconfiguration | Host, XFF, CORS                   |
| A7 Auth Failures    | JWT headers                       |
| A8 Integrity        | Content-Type, caching             |
| A10 Logging         | User-Agent, Referer               |

### Самые уязвимые заголовки (TOP-10 AppSec)
`1. Authorization`

Проверить:
* Используется ли Authorization: Bearer ...
* JWT (JSON Web Token) или opaque (непрозрачный) token
* Проверяется ли подпись и срок

Сделать:
* Убрать подпись (alg: none)
* Заменить user_id / role
* Повторно использовать токен

Результат:
* Broken Authentication
* Privilege Escalation

`2. Cookie / Set-Cookie`

Проверить:
* Есть ли HttpOnly
* Есть ли Secure
* Есть ли SameSite
* Сессия меняется после логина?

Сделать:
* Передать чужую cookie
* Фиксировать сессию до логина
* Использовать в HTTP

Результат:
* Session hijacking
* Session fixation

`3. Host`

Проверить:
* Используется ли Host для: 
    * reset-ссылок; 
    * callback URL; 
    * редиректов.

Сделать:
```
Host: evil.com
```
Сайт evil.com тайно отправляет запрос Get /api/account на сохраненный в куках сайт.

Результат:
* Password reset hijack
* Cache poisoning

`4. X-Forwarded-For`

Проверить:
* Используются ли для:
    * rate-limit
    * ACL
    * admin-доступа

Сделать:
```
X-Forwarded-For: 127.0.0.1
```
Результат:
* Bypass rate limit
* Internal access

`5. Origin`

Проверить:
* Проверяется ли Origin
* Отражается ли в ответе

Сделать:
```
Origin: https://evil.com
```
Результат:
* CORS bypass
* CSRF via CORS

`6. Access-Control-Allow-Origin`

Проверить:
* `* + credentials?`
* динамическое отражение Origin?

Сделать:
* Запрос с чужого домена
* Чтение ответа с cookies

Результат:
* Data exfiltration

`7. Content-Type`

Проверить:
* Проверяется ли сервером
* Или только на фронте

Сделать:
```
Content-Type: image/png
```
(а внутри JS / HTML)

Результат:
* File upload bypass
* XSS

`8. Content-Length / Transfer-Encoding`

Проверить:
* Есть ли прокси + backend
* Как обрабатываются оба заголовка

Сделать:
* Несовпадение CL / TE

Результат:
* Request smuggling

`9. Location`

Проверить:
* Можно ли влиять на redirect URL

Сделать:
```
Location: https://evil.com
```
Результат:
* Open Redirect
* OAuth token leak

`10. User-Agent / Referer`

Проверить:
* Логируются ли
* Отображаются ли в UI

Сделать:
```
User-Agent: <script>alert(1)</script>
```
Результат:
* Stored XSS
* Log injection

`11. Content-Length`
`12. Location`
`13. WWW-Authenticate`
`14. Cache-Control`
`15. X-Request-ID`
`16. X-Real-IP`
`17. X-User`
`18. X-Role`
`19. X-Admin`
`20. X-Internal`
`21. X-Auth-Token`

---

Для каждого приложения:
1. Перехват запроса (Burp)
2. Анализ заголовка:
   * Сервер доверяет?
   * Можно подменить?
   * Влияет ли на логику / доступ?

---

## Шаблоны проектирования

### 1. Шаблон преобразователь (Transform View)
Этот шаблон преобразует модель данных в HTML-код, обычно используется для представления данных в виде таблиц или графиков.

#### Риски:
* `XSS` (Cross-Site Scripting): если данные не экранируются правильно перед их вставкой в HTML, злоумышленник может вставить вредоносный скрипт.
* `Отсутствие проверки данных`: при динамическом преобразовании данных могут быть не проверены данные, что создаёт возможность инъекций.

#### OWASP:
* A3: `Injection`: Проблемы с инъекциями могут возникать, если данные не экранируются должным образом перед вставкой в HTML.
* A1: Injection (`SQLi`, `Command`, `XPath`, etc.): Это может быть связано с небезопасным формированием запросов, например, через шаблоны, которые плохо обрабатывают вводимые данные.
* A7: Cross-Site Scripting (`XSS`): Вставка данных без экранирования может привести к XSS-уязвимостям.

#### Как анализировать:
* Проверять, как данные из модели передаются в представление. Убедиться, что они проходят через функции экранирования HTML.
* Анализировать, используете ли вы шаблонизаторы, которые автоматически обрабатывают экранирование.

#### OWASP Best Practices:
* Использовать безопасные шаблонизаторы (например, Jinja2, Mustache, Handlebars) с автоматической экранировкой данных.
* Валидация и фильтрация данных, поступающих в шаблон, на стороне сервера.

---

### 2. Шаблон шаблонизатор (Template View)
Преобразует HTML-шаблон с маркерами в полноценную веб-страницу, заполняя маркеры данными.

#### Риски:
* `XSS` и `инъекции`: если шаблон не правильно экранирует или валидирует пользовательские данные, может возникнуть возможность внедрения скриптов.
* `Шаблонные инъекции`: если данные, передаваемые в шаблон, не фильтруются должным образом, злоумышленник может внедрить свой код в шаблон.

#### OWASP:
* A7: Cross-Site Scripting (`XSS`), если шаблонизатор не экранирует данные, передаваемые в HTML.
* A10: `Insufficient Logging & Monitoring`: Проблемы с отслеживанием ошибок в шаблонизаторах могут привести к тому, что важные ошибки или инъекции будут упущены.

#### Как анализировать:
* Оценить, как работает шаблонизатор, и проверить, имеет ли он встроенные средства для защиты от инъекций.
* Проверить, как данные передаются в шаблон и как обрабатываются маркеры.

#### OWASP Best Practices:
* Использование проверенных шаблонизаторов с автоматической обработкой экранирования.
* Логирование ошибок и инцидентов, связанных с шаблонами.

---

### 3. Шаблон контроллер приложения (Application Controller)
Единая точка управления для отображения и выполнения приложения, которая обрабатывает запросы и направляет их на соответствующие компоненты.

#### Риски:
* `CSRF` (Cross-Site Request Forgery): Если контроллер не защищён от подделки запросов, злоумышленник может заставить пользователя отправить запросы от его имени.
* `Неправильное управление сессиями`: если контроллер не правильно управляет сессиями, злоумышленник может получить доступ к личным данным.

#### OWASP:
* A2: `Broken Authentication`;
* A5: `Security Misconfiguration`: Если контроллер не правильно управляет аутентификацией или правами доступа, это может стать причиной утечек данных.
* A6: `Sensitive Data Exposure`: Контроллер может неправильно обрабатывать чувствительные данные, например, если они не шифруются должным образом.

#### Как анализировать:
* Проверить, как контроллер управляет сессиями и аутентификацией.
* Анализировать, как контроллер обрабатывает запросы и какие проверки безопасности (например, CSRF) он применяет.

#### OWASP Best Practices:
* Контроллер должен проверять права доступа каждого пользователя для каждой операции.
* Использование безопасных механизмов аутентификации и защиты сессий.

---

### 4. Шаблон двухшаговая шаблонизация (Two Step View)
Преобразует данные в HTML в два шага: сначала формирует логическую структуру, затем заполняет её данными.

#### Риски:
* `Ошибки при формировании структуры`: если структура данных создаётся динамически без проверки, можно столкнуться с инъекциями или некорректным отображением данных.
* `Сложность в защите`: если шаблоны и логика разделены, это может усложнить анализ уязвимостей.

#### OWASP:
* A3: `Injection`: Инъекции могут происходить при трансформации данных в HTML или другой формат.
* A9: `Using Components with Known Vulnerabilities`: В некоторых случаях шаблонизация может использовать уязвимые компоненты.

#### Как анализировать:
* Проверить, как данные и логика разделены, и нет ли уязвимости в процессе трансформации данных.
* Оценить, как обработка данных может повлиять на безопасность.

#### OWASP Best Practices:
* Использование безопасных компонентов и библиотек для обработки данных.
* Сканирование компонентов на наличие известных уязвимостей.

---

### 5. Шаблон контроллер страницы (Page Controller)
Обрабатывает запросы для конкретной страницы или действия, например, для отображения определённой веб-страницы или выполнения действия.

#### Риски:
* `Доступность`: если не обеспечено правильное разграничение доступа, то любой может обратиться к критически важным страницам.
* `Логирование и обработка ошибок`: если ошибки или данные запросов не логируются или не обрабатываются должным образом, это может привести к утечкам информации.

#### OWASP:
* A8: Cross-Site Request Forgery (`CSRF`): При использовании контроллеров для обработки страниц важно защищать их от атак CSRF.
* A6: `Sensitive Data Exposure`: Если контроллеры не защищают чувствительные данные должным образом, это может привести к утечкам.

#### Как анализировать:
* Проверить доступность страниц и обработку аутентификации на уровне контроллеров.
* Изучить, как контроллеры обрабатывают ошибки и логируют данные.

#### OWASP Best Practices:
* Использование CSRF-токенов для защиты от атак CSRF.
* Защита данных на уровне контроллеров и проверка параметров запроса.

---

### 6. Шаблон контроллер входа / Единая точка входа (Front Controller)
Один контроллер обрабатывает все запросы на сайт, обычно используется для обработки всех HTTP-запросов.

#### Риски:
* `Single point of failure`: если контроллер не защищён, злоумышленник может обойти все другие слои безопасности.
* `Проблемы с сессиями и аутентификацией`: ошибка на этом уровне может привести к утечке данных сессий или аккаунтов.

#### OWASP: 
* A2: `Broken Authentication`: Если один контроллер обрабатывает все запросы, важно убедиться, что аутентификация и авторизация правильно выполняются.
* A5: `Security Misconfiguration`: Необходимо избегать неправильных настроек, которые могут привести к уязвимостям через единую точку входа.

#### Как анализировать:
* Проверить, как контроллер управляет входом, сессиями и защищает приложение от атак.
* Анализировать логику обработки запросов и их валидации на уровне входа.

#### OWASP Best Practices:
* Защита аутентификации и авторизации на уровне контроллера.
* Валидация всех входящих запросов.

---

### 7. Шаблон модель-вид-контроллер (MVC, Model View Controller)
Разделяет приложение на три основные части: модель (данные), вид (представление), контроллер (логика).

#### Риски:
* `Уязвимости модели`: если модель не защищена должным образом, это может привести к SQL-инъекциям, утечкам данных и другим уязвимостям.
* `Неправильная валидация данных на уровне контроллера`: это может позволить злонамеренно изменять данные или использовать приложение для атак.
* `Отсутствие разделения привилегий между компонентами`: если контроллер и модель не разделяют права доступа должным образом, это может привести к ошибкам безопасности.

#### OWASP: 
* A1: Injection (`SQLi`, `Command`, etc.): Если модель не защищена от инъекций.
* A7: Cross-Site Scripting (`XSS`): Если контроллеры не правильно обрабатывают данные, передаваемые в представление.
* A9: `Using Components with Known Vulnerabilities`: Ошибки в архитектуре могут привести к использованию уязвимых компонентов в модели или контроллере.

#### Как анализировать:
* Проверить, как контроллеры обрабатывают данные, аутентификацию и авторизацию.
* Анализировать модель на уязвимости типа SQLi и правильность обработки данных.
* Оценить, как структура разделения компонентов помогает или затрудняет защиту данных.

#### OWASP Best Practices:
* Применение принципов наименования и изоляции обязанностей в компонентной архитектуре.
* Использование безопасных API для связи между моделями, видами и контроллерами.
* Регулярные проверки на уязвимости компонентов.